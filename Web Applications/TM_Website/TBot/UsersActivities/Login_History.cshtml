
@using System
@using System.Linq
@using O2.DotNetWrappers.ExtensionMethods
@using TeamMentor.CoreLib

@{
    var weekAgo = DateTime.Today.AddDays(-7).ToFileTimeUtc();
    var max = System.Web.HttpContext.Current.Request["max"].toInt();

    if (max == 0) {
        max = 50;
    }
}

@{
    <h5>Users Logged in During Last Week</h5>

    <ul>
        <table class="table table-striped table-condensed">
            @{ 
                var date = DateTime.MinValue; 
                var count = 0; 
            }
            @foreach (var user in TM_UserData.Current.TMUsers.Where(x => x.UserActivities.Any(y => y.When > weekAgo)).OrderByDescending(z => z.UserActivities.Last().When))
            {
                if (@user.UserActivities.Last().When.ToDate() != date)
                {
                    <tr>
                        <th>Username</th>
                        <th>Name</th>
                        <th>@user.UserActivities.Last().When.ToDate().ToShortDateString()</th>
                        <th>IP Address</th>
                    </tr>

                    date = @user.UserActivities.Last().When.ToDate();
                }                
                <tr>
                    <td><a href="User_Activities?userName=@user.UserName&max=@max">@user.UserName</a> </td>
                    <td>@user.FirstName.replace("FName", "") @user.LastName.replace("LName", "")</td>
                    <td>@user.UserActivities.Last().When.ToDateTimeString()</td>
                    <td>@user.UserActivities.Last().IPAddress</td>
                </tr>
            }
        </table>
    </ul>
}

It's @DateTime.Now.ToLongTimeString()  on @DateTime.Now.ToLongDateString()
