<script src="/Javascript/angularJS/modules/uiValidateEquals.js" type="text/javascript"></script>
<script>
    
function TMUser($scope,$http)
    {        
        $scope.update = function(userData)
            {                
                $scope.result = "... saving user";
                $http.put('/rest/user/changePassword',userData)
                    .success(function(data)
                        {
                            $scope.result = data == 'true' ? "(User details saved)" : "Error: Failed to Save user!";
                        })

            }

        var userName = window.location.search.substring(1);
        if (userName != "")
        {
                $http.get('/rest/user/' + userName).success(function(data)
                    {                 
                        $scope.userData = data;
                    });        
        }
    }    
</script>

<div ng-controller="TMUser">
    	
    <a href="User_View?userName={{userData.UserName}}" class="btn btn-info" >View User</a>
    <a href="User_Edit?{{userData.UserName}}" class="btn btn-info">Edit User</a>
    <a href="User_ChangePassword?{{userData.UserName}}" class="btn btn-info" disabled>Change Password</a>
    <a href="User_Activities?userName={{userData.UserName}}" class="btn btn-info" >View Activity/Logs</a>
    <a href="User_Raw?userName={{userData.UserName}}">Raw/Xml Data</a>

    <h4>Change Password</h4>
    
    <form name="myForm" class="css-form" ng-submit="update(userData)">    
        <ul>
            <p>        
                <b>User ID</b> {{userData.UserId}}
            </p>
             <div class="input-prepend">
                <span class="add-on" style="width:120px;">UserName</span>
                <input name="username" type="text" style="width:250px;" ng-model="userData.UserName" disabled="disabled"/>
            </div><br/>
            <div class="input-prepend">
                <span class="add-on" style="width:120px;">New Password</span>
                <input maxlength="30" type="password" id="newPassword" type="text" style="width:250px;" ng-model="userData.newPassword" required pattern="(?=.*\d)(?=.*[a-zA-Z]).{8,}" title="Password must contain a letter and number character and be at least eight characters long." />
            </div><br/>
            
            <div class="input-prepend">
                <span class="add-on" style="width:120px;">Confirm Password</span>
                <input maxlength="30" type="password" id="confirmPassword" type="text" style="width:250px;" required />
            </div><br/>
           
            <br/>          
            
              
            <button class="btn btn-primary">Save</button>  <small><a href="Current_Users">back to user's list</a>&nbsp;&nbsp;{{result}}</small>
        </ul>    

    </form>
    
    <small><a href="javascript:window.location = window.location">reload page</a></small>

</div>

<script type="text/javascript">
 
    var confirmPassword = document.getElementById("confirmPassword");
 
    confirmPassword.addEventListener("input", function() {

        var errorMessage;

        if (confirmPassword.value != document.getElementById("newPassword").value)
            {
                errorMessage = "Please make sure this is the same as your new password.";
            }
        else
            {
            errorMessage = "";
            }

            confirmPassword.setCustomValidity(errorMessage);
    });
 
</script>

<style type="text/css">
  .css-form input.ng-invalid.ng-dirty 
  {
    background-color: #FA787E;
  }

</style>

<hr/>
<a href="Current_Users">back to users list</a>